<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}{% endblock %}</title>
  <style>
    :root { --bg:#0b1324; --card:#101935; --muted:#7b8ab8; --ok:#1db954; --warn:#ffb020; --err:#ff4757; }
    body { margin:0; font:14px/1.5 system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:#e8eeff; }
    header { padding:14px 18px; background:#0d1530; position:sticky; top:0; z-index:10; }
    header a { color:#cfe1ff; text-decoration:none; margin-right:16px; }
    main { max-width:980px; margin:22px auto; padding:0 14px; }
    .card { background:var(--card); border-radius:14px; padding:16px; box-shadow:0 8px 30px rgba(0,0,0,.2); margin-bottom:16px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .row > * { flex:1 1 220px; }
    label { display:block; margin-bottom:6px; color:#bcd; }
    input, select, textarea, button { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #334; background:#0b1226; color:#e8eeff; }
    button.primary { background:#2956ff; border-color:#2956ff; font-weight:600; }
    button.ok { background:var(--ok); border-color:var(--ok); }
    button.warn { background:var(--warn); border-color:var(--warn); color:#111; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid #2b3355; }
    th { text-align:left; color:#bcd; }
    .muted { color:var(--muted); }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; }
    .pill.ok { background:rgba(29,185,84,.15); color:#b1f5c9; }
    .pill.err { background:rgba(255,71,87,.15); color:#ffb3bb; }
    .pill.warn { background:rgba(255,176,32,.15); color:#ffd99a; }
    .grid2 { display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
    .right { text-align:right; }
    .small { font-size:12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  </style>
  {% block head %}{% endblock %}
</head>
<body>
<header>
  <a href="/erp/attend/test">Check IN/OUT</a>
  <a href="/erp/attend/history">Lịch sử</a>
</header>
<main>
  {% block content %}{% endblock %}
</main>
<script>
  // CSRF helper (SessionAuthentication)
  function getCookie(name) {
    const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return m ? m.pop() : '';
  }
  const CSRF_TOKEN = getCookie('csrftoken');

  const API_PREFIX = "/erp"; // đổi nếu khác
  const API = {
    CHECK:  API_PREFIX + "/api/attend/check",
    LIST:   API_PREFIX + "/api/attend/list",
    EXPORT: API_PREFIX + "/api/attend/export",
    EMPS:   API_PREFIX + "/api/employees",
    WSS:    API_PREFIX + "/api/worksites",
  };

  async function jsonFetch(url, opts={}) {
    const headers = Object.assign({ "Content-Type":"application/json" }, opts.headers||{});
    // nếu dùng session + csrf:
    headers["X-CSRFToken"] = CSRF_TOKEN || headers["X-CSRFToken"];
    const res = await fetch(url, Object.assign({}, opts, { headers }));
    const ct = res.headers.get("content-type") || "";
    const data = ct.includes("application/json") ? await res.json() : await res.text();
    if (!res.ok) {
      throw { status: res.status, data };
    }
    return data;
  }
</script>
{% block scripts %}{% endblock %}
</body>
</html>
