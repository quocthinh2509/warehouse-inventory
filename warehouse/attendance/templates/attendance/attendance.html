<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chấm công</title>
</head>
<body>
<h1>Hệ thống chấm công</h1>
<label>User ID: <input id="user-id" placeholder="Nhập ID"></label><br><br>
<button onclick="sendAttendance('checkin')">Check-in</button>
<button onclick="sendAttendance('checkout')">Check-out</button>

<div id="msg"></div>

<script>
async function getPublicIP() {
  const res = await fetch('https://api.ipify.org/?format=json');
  const data = await res.json();
  return data.ip;
}

async function sendAttendance(action) {
  const userId = document.getElementById('user-id').value || 'unknown';
  const msgDiv = document.getElementById('msg');
  msgDiv.innerText = 'Đang gửi...';

  try {
    const ip = await getPublicIP();

    const res = await fetch('/ui/api/attendance/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId, action, ip })
    });

    const data = await res.json();
    msgDiv.innerText = JSON.stringify(data);
  } catch (err) {
    msgDiv.innerText = 'Lỗi: ' + err.message;
  }
}
</script>
</body>
</html>
