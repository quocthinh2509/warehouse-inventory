{% load static %}
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Leave — ERP Test</title>
  <link rel="stylesheet" href="{% static 'erp/styles.css' %}" />
</head>
<body>
  <main class="container">
    <div class="row" style="justify-content:space-between; align-items:center">
      <h1>Leave</h1>
      <form id="baseurl-form" class="row" style="gap:8px; min-width:360px">
        <input name="base_url" placeholder="http://127.0.0.1:8000/erp/api" />
        <button class="primary" type="submit">Save base_url</button>
      </form>
    </div>

    <div class="grid grid-2">
      <section class="card">
        <h2>Create Leave Type</h2>
        <form id="f-ltype">
          <label>Mã</label><input name="code" required />
          <label>Tên</label><input name="name" required />
          <label>Paid</label><select name="paid"><option value="true" selected>true</option><option>false</option></select>
          <button class="primary">Create</button>
        </form>
        <pre id="ltype-list" class="small"></pre>
      </section>

      <section class="card">
        <h2>Leave Request</h2>
        <form id="f-lreq">
          <label>Employee ID</label><input name="employee" value="1" />
          <label>LeaveType ID</label><input name="leave_type" value="1" />
          <div class="row">
            <div style="flex:1"><label>Start</label><input name="start_date" value="2025-09-20" /></div>
            <div style="flex:1"><label>End</label><input name="end_date" value="2025-09-21" /></div>
          </div>
          <label>Reason</label><input name="reason" placeholder="..." />
          <label>Status</label><select name="status"><option>submitted</option><option>approved</option><option>rejected</option></select>
          <button class="primary">Create</button>
        </form>
        <pre id="lreq-list" class="small"></pre>
      </section>
    </div>
  </main>
  <div class="toast"></div>
  <script type="module">
    import { fetchJSON, setFormHandlers, formToJSON, setBaseUrlForm } from "{% static 'erp/app.js' %}";
    setBaseUrlForm('#baseurl-form');

    async function reload(){
      const lt = await fetchJSON('/leave-types/');
      document.querySelector('#ltype-list').textContent = JSON.stringify(lt, null, 2);
      const lr = await fetchJSON('/leave-requests/');
      document.querySelector('#lreq-list').textContent = JSON.stringify(lr, null, 2);
    }
    setFormHandlers('#f-ltype', async fd=>{
      const data = formToJSON(fd); data.paid = data.paid==='true';
      await fetchJSON('/leave-types/', { method:'POST', body: JSON.stringify(data) });
      reload();
    });
    setFormHandlers('#f-lreq', async fd=>{
      await fetchJSON('/leave-requests/', { method:'POST', body: JSON.stringify(formToJSON(fd)) });
      reload();
    });
    reload();
  </script>
</body>
</html>
